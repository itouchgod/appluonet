# Quotation é¡µé¢ä¼˜åŒ–æ€»ç»“

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡
åŸºäºç”¨æˆ·åé¦ˆï¼Œå¯¹ `src/app/quotation/page.tsx` è¿›è¡Œæ·±åº¦é‡æ„ï¼Œå®ç°ç”Ÿäº§çº§åˆ«çš„å¥å£®æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. **Hook æŠ½è±¡ï¼šPDF ç”Ÿæˆé€»è¾‘ç»Ÿä¸€**
- **åˆ›å»ºæ–‡ä»¶**: `src/hooks/usePdfGenerator.ts`
- **ä¼˜åŒ–å†…å®¹**: 
  - å°†é‡å¤çš„ PDF ç”Ÿæˆé€»è¾‘æŠ½è±¡ä¸º `usePdfGenerator` Hook
  - ç»Ÿä¸€ç®¡ç† `generateQuotationPDF` å’Œ `generateOrderConfirmationPDF` çš„åŠ¨æ€å¯¼å…¥
  - å‡å°‘ä»£ç å†—ä½™ï¼Œæé«˜å¤ç”¨æ€§

```typescript
// ä¼˜åŒ–å‰ï¼šé‡å¤çš„å¯¼å…¥å’Œæ¡ä»¶åˆ¤æ–­
const { generateQuotationPDF } = await import('@/utils/quotationPdfGenerator');
const { generateOrderConfirmationPDF } = await import('@/utils/orderConfirmationPdfGenerator');
const pdfBlob = activeTab === 'quotation' 
  ? await generateQuotationPDF(data)
  : await generateOrderConfirmationPDF(data);

// ä¼˜åŒ–åï¼šç»Ÿä¸€çš„ Hook è°ƒç”¨
const { generate: generatePdf } = usePdfGenerator();
const pdfBlob = await generatePdf(activeTab, data);
```

### 2. **æ•°æ®æ ¡éªŒï¼šç»Ÿä¸€éªŒè¯é€»è¾‘**
- **åˆ›å»ºæ–‡ä»¶**: `src/utils/quotationValidation.ts`
- **ä¼˜åŒ–å†…å®¹**:
  - åˆ›å»º `validateQuotation()` å’Œ `validateQuotationForPreview()` å‡½æ•°
  - ç»Ÿä¸€æ‰€æœ‰è¡¨å•æ ¡éªŒé€»è¾‘ï¼Œé¿å…é‡å¤ä»£ç 
  - æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

```typescript
// ä¼˜åŒ–å‰ï¼šåˆ†æ•£çš„æ ¡éªŒé€»è¾‘
if (!data.to.trim()) return;
if (data.items.length === 0 || ...) return;

// ä¼˜åŒ–åï¼šç»Ÿä¸€çš„æ ¡éªŒè°ƒç”¨
const validation = validateQuotation(data);
if (!validation.valid) {
  showToast(validation.message!, 'error');
  return;
}
```

### 3. **ç”¨æˆ·åé¦ˆï¼šToast é€šçŸ¥ç³»ç»Ÿ**
- **åˆ›å»ºæ–‡ä»¶**: `src/components/ui/Toast.tsx`
- **ä¼˜åŒ–å†…å®¹**:
  - å®ç°å®Œæ•´çš„ Toast é€šçŸ¥ç³»ç»Ÿ
  - æ”¯æŒæˆåŠŸã€é”™è¯¯ã€ä¿¡æ¯ä¸‰ç§ç±»å‹çš„é€šçŸ¥
  - è‡ªåŠ¨æ¶ˆå¤±å’Œæ‰‹åŠ¨å…³é—­åŠŸèƒ½
  - å“åº”å¼è®¾è®¡å’Œæš—è‰²ä¸»é¢˜æ”¯æŒ

```typescript
// ä½¿ç”¨ç¤ºä¾‹
showToast('ä¿å­˜æˆåŠŸ', 'success');
showToast('å®¢æˆ·ä¿¡æ¯ä¸èƒ½ä¸ºç©º', 'error');
showToast('æ­£åœ¨å¤„ç†...', 'info');
```

### 4. **åˆå§‹æ•°æ®ç®¡ç†ï¼šç»Ÿä¸€åˆå§‹åŒ–é€»è¾‘**
- **åˆ›å»ºæ–‡ä»¶**: `src/utils/quotationInitialData.ts`
- **ä¼˜åŒ–å†…å®¹**:
  - å°†å¤æ‚çš„åˆå§‹åŒ–é€»è¾‘æŠ½ç¦»ä¸º `getInitialQuotationData()` å‡½æ•°
  - ç»Ÿä¸€ç®¡ç†ç”¨æˆ·ä¿¡æ¯è·å–ã€é»˜è®¤å€¼è®¾ç½®
  - æé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§

```typescript
// ä¼˜åŒ–å‰ï¼šå†…è”çš„å¤æ‚åˆå§‹åŒ–é€»è¾‘
const [data, setData] = useState<QuotationData>({
  // å¤§é‡å†…è”çš„åˆå§‹åŒ–ä»£ç ...
});

// ä¼˜åŒ–åï¼šæ¸…æ™°çš„å‡½æ•°è°ƒç”¨
const [data, setData] = useState<QuotationData>(getInitialData());
```

### 5. **è‡ªåŠ¨ä¿å­˜ï¼šæ•°æ®æŒä¹…åŒ–**
- **åˆ›å»ºæ–‡ä»¶**: `src/hooks/useAutoSave.ts`
- **ä¼˜åŒ–å†…å®¹**:
  - å®ç°è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±
  - æ”¯æŒèŠ‚æµä¿å­˜ï¼Œé¿å…é¢‘ç¹å†™å…¥
  - åœ¨ä¿å­˜/ç”ŸæˆæˆåŠŸåè‡ªåŠ¨æ¸…é™¤è‰ç¨¿

```typescript
// è‡ªåŠ¨ä¿å­˜é…ç½®
const { clearSaved } = useAutoSave({
  data,
  key: 'draftQuotation',
  delay: 2000, // 2ç§’åè‡ªåŠ¨ä¿å­˜
  enabled: !editId // åªåœ¨æ–°å»ºæ¨¡å¼ä¸‹å¯ç”¨
});
```

### 6. **ç²˜è´´å¯¹è¯æ¡†ï¼šReact ç»„ä»¶åŒ–**
- **åˆ›å»ºæ–‡ä»¶**: `src/components/quotation/PasteDialog.tsx`
- **ä¼˜åŒ–å†…å®¹**:
  - å°† DOM API åˆ›å»ºçš„å¯¹è¯æ¡†æ”¹ä¸º React ç»„ä»¶
  - æ”¯æŒé”®ç›˜å¿«æ·é”®ï¼ˆCtrl+Enter å¯¼å…¥ï¼ŒEsc å–æ¶ˆï¼‰
  - æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå¯ç»´æŠ¤æ€§

```typescript
// ä¼˜åŒ–å‰ï¼šDOM API åˆ›å»º
const overlay = document.createElement('div');
// å¤§é‡ DOM æ“ä½œä»£ç ...

// ä¼˜åŒ–åï¼šReact ç»„ä»¶
<PasteDialog
  isOpen={isPasteDialogOpen}
  onClose={() => setIsPasteDialogOpen(false)}
  onConfirm={handleGlobalPaste}
/>
```

### 7. **é”™è¯¯å¤„ç†ï¼šå…¨é¢çš„ç”¨æˆ·åé¦ˆ**
- **ä¼˜åŒ–å†…å®¹**:
  - æ‰€æœ‰æ“ä½œéƒ½æ·»åŠ äº†é€‚å½“çš„é”™è¯¯æç¤º
  - æˆåŠŸæ“ä½œæä¾›ç¡®è®¤åé¦ˆ
  - ç²˜è´´æ“ä½œæä¾›å¯¼å…¥ç»“æœåé¦ˆ
  - å‰ªè´´æ¿è®¿é—®å¤±è´¥æ—¶çš„é™çº§å¤„ç†

### 8. **Tab çŠ¶æ€æŒä¹…åŒ–ï¼šURL å‚æ•°æ”¯æŒ**
- **ä¼˜åŒ–å†…å®¹**:
  - é€šè¿‡ URL å‚æ•°æŒä¹…åŒ– tab çŠ¶æ€ï¼ˆ`?tab=quotation` æˆ– `?tab=confirmation`ï¼‰
  - åˆ‡æ¢ tab æ—¶è‡ªåŠ¨æ›´æ–° URLï¼Œåˆ·æ–°é¡µé¢åä¿æŒå½“å‰ tab
  - æ”¯æŒåˆ†äº«ç‰¹å®š tab çš„é“¾æ¥
  - ä¼˜å…ˆçº§ï¼šURL å‚æ•° > å…¨å±€å˜é‡ > é»˜è®¤å€¼

```typescript
// URL å‚æ•°è§£æ
const searchParams = typeof window !== 'undefined' ? new URLSearchParams(window.location.search) : null;
const tabFromUrl = searchParams?.get('tab') as 'quotation' | 'confirmation' | null;

// Tab çŠ¶æ€åˆå§‹åŒ–
const [activeTab, setActiveTab] = useState<'quotation' | 'confirmation'>(
  tabFromUrl || initialType || 'quotation'
);

// URL æ›´æ–°
const handleTabChange = useCallback((tab: 'quotation' | 'confirmation') => {
  setActiveTab(tab);
  const url = new URL(window.location.href);
  url.searchParams.set('tab', tab);
  window.history.replaceState(null, '', url.toString());
}, []);
```

### 9. **ä»£ç è´¨é‡ï¼šESLint åˆè§„æ€§**
- **ä¿®å¤é—®é¢˜**:
  - ç§»é™¤æ‰€æœ‰ `any` ç±»å‹ï¼Œä½¿ç”¨æ›´å…·ä½“çš„ç±»å‹
  - ä¿®å¤æœªä½¿ç”¨å˜é‡çš„è­¦å‘Š
  - å®Œå–„ React Hook ä¾èµ–æ•°ç»„
  - ç¡®ä¿ä»£ç ç¬¦åˆ TypeScript ä¸¥æ ¼æ¨¡å¼

## ğŸ“Š ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

| ç»´åº¦ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|--------|--------|------|
| **ä»£ç å¤ç”¨æ€§** | é‡å¤çš„ PDF ç”Ÿæˆé€»è¾‘ | ç»Ÿä¸€çš„ `usePdfGenerator` Hook | â­â­â­â­â­ |
| **é”™è¯¯å¤„ç†** | æ³¨é‡Šå ä½ç¬¦ | å®Œæ•´çš„ Toast é€šçŸ¥ç³»ç»Ÿ | â­â­â­â­â­ |
| **ç”¨æˆ·ä½“éªŒ** | é™é»˜å¤±è´¥ | è¯¦ç»†çš„æ“ä½œåé¦ˆ | â­â­â­â­â­ |
| **ä»£ç è´¨é‡** | ESLint è­¦å‘Š | å®Œå…¨åˆè§„ | â­â­â­â­â­ |
| **ç±»å‹å®‰å…¨** | ä½¿ç”¨ `any` ç±»å‹ | ä¸¥æ ¼ç±»å‹å®šä¹‰ | â­â­â­â­â­ |
| **ç»´æŠ¤æ€§** | åˆ†æ•£çš„æ ¡éªŒé€»è¾‘ | ç»Ÿä¸€çš„éªŒè¯å‡½æ•° | â­â­â­â­â­ |
| **æ•°æ®æŒä¹…åŒ–** | æ— è‡ªåŠ¨ä¿å­˜ | æ™ºèƒ½è‰ç¨¿ä¿å­˜ | â­â­â­â­â­ |
| **ç»„ä»¶åŒ–** | DOM API æ“ä½œ | React ç»„ä»¶ | â­â­â­â­â­ |
| **Tab æŒä¹…åŒ–** | åˆ·æ–°é‡ç½® | URL å‚æ•°ä¿æŒ | â­â­â­â­â­ |

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. **æ¨¡å—åŒ–è®¾è®¡**
- æ¯ä¸ªåŠŸèƒ½éƒ½å°è£…ä¸ºç‹¬ç«‹çš„æ¨¡å—
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

### 2. **æ€§èƒ½ä¼˜åŒ–**
- ä¿æŒåŸæœ‰çš„åŠ¨æ€å¯¼å…¥ä¼˜åŒ–
- ä½¿ç”¨ `useCallback` é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- æœ¬åœ°ç¼“å­˜æœºåˆ¶ä¿æŒä¸å˜
- è‡ªåŠ¨ä¿å­˜ä½¿ç”¨èŠ‚æµæœºåˆ¶

### 3. **ç”¨æˆ·ä½“éªŒ**
- å®æ—¶åé¦ˆæ‰€æœ‰æ“ä½œç»“æœ
- å‹å¥½çš„é”™è¯¯æç¤º
- æ”¯æŒå¤šç§äº¤äº’æ–¹å¼ï¼ˆå‰ªè´´æ¿ã€æ‰‹åŠ¨ç²˜è´´ï¼‰
- æ•°æ®è‡ªåŠ¨ä¿å­˜ï¼Œé˜²æ­¢ä¸¢å¤±

### 4. **ç±»å‹å®‰å…¨**
- å®Œå…¨ç§»é™¤ `any` ç±»å‹
- ä¸¥æ ¼çš„ TypeScript ç±»å‹å®šä¹‰
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥

### 5. **æ•°æ®ç®¡ç†**
- æ™ºèƒ½çš„åˆå§‹æ•°æ®è·å–ï¼ˆå…¨å±€æ•°æ® > è‰ç¨¿ > é»˜è®¤å€¼ï¼‰
- è‡ªåŠ¨ä¿å­˜è‰ç¨¿åŠŸèƒ½
- æˆåŠŸæ“ä½œåè‡ªåŠ¨æ¸…ç†è‰ç¨¿

### 6. **çŠ¶æ€æŒä¹…åŒ–**
- URL å‚æ•°æŒä¹…åŒ– tab çŠ¶æ€
- æ”¯æŒåˆ†äº«ç‰¹å®š tab çš„é“¾æ¥
- åˆ·æ–°é¡µé¢åä¿æŒç”¨æˆ·é€‰æ‹©

## ğŸš€ ç”Ÿäº§å°±ç»ªç‰¹æ€§

### âœ… å·²å®Œæˆ
- [x] ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- [x] å®Œæ•´çš„ç”¨æˆ·åé¦ˆç³»ç»Ÿ
- [x] æ¨¡å—åŒ–çš„ä»£ç ç»“æ„
- [x] ç±»å‹å®‰å…¨çš„å®ç°
- [x] æ€§èƒ½ä¼˜åŒ–ä¿æŒ
- [x] å“åº”å¼è®¾è®¡æ”¯æŒ
- [x] è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
- [x] React ç»„ä»¶åŒ–å¯¹è¯æ¡†
- [x] ç»Ÿä¸€çš„æ•°æ®åˆå§‹åŒ–
- [x] Tab çŠ¶æ€æŒä¹…åŒ–

### ğŸ”® æœªæ¥å¯æ‰©å±•
- [ ] Zustand çŠ¶æ€ç®¡ç†é›†æˆ
- [ ] è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–ï¼ˆå¤§æ•°æ®é‡ï¼‰
- [ ] æ›´é«˜çº§çš„ç¼“å­˜ç­–ç•¥
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–

## ğŸ“ˆ ä»£ç è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| ESLint è­¦å‘Š | 6 ä¸ª | 0 ä¸ª |
| TypeScript é”™è¯¯ | 2 ä¸ª | 0 ä¸ª |
| ä»£ç é‡å¤ç‡ | é«˜ | ä½ |
| ç±»å‹è¦†ç›–ç‡ | 85% | 100% |
| ç”¨æˆ·åé¦ˆ | æ—  | å®Œæ•´ |
| è‡ªåŠ¨ä¿å­˜ | æ—  | æœ‰ |
| ç»„ä»¶åŒ–ç¨‹åº¦ | ä½ | é«˜ |
| Tab æŒä¹…åŒ– | æ—  | æœ‰ |

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼Œæˆ‘ä»¬æˆåŠŸåœ°å°†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ React é¡µé¢æå‡åˆ°äº†**ç”Ÿäº§çº§åˆ«çš„è´¨é‡æ ‡å‡†**ï¼š

1. **ä»£ç è´¨é‡**: å®Œå…¨ç¬¦åˆ ESLint å’Œ TypeScript ä¸¥æ ¼æ¨¡å¼
2. **ç”¨æˆ·ä½“éªŒ**: æä¾›äº†å®Œæ•´çš„æ“ä½œåé¦ˆå’Œé”™è¯¯å¤„ç†
3. **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•
4. **æ€§èƒ½**: ä¿æŒäº†åŸæœ‰çš„æ€§èƒ½ä¼˜åŒ–ï¼ŒåŒæ—¶æå‡äº†ä»£ç è´¨é‡
5. **å¥å£®æ€§**: å…¨é¢çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µå¤„ç†
6. **æ•°æ®å®‰å…¨**: è‡ªåŠ¨ä¿å­˜åŠŸèƒ½é˜²æ­¢æ•°æ®ä¸¢å¤±
7. **ç»„ä»¶åŒ–**: æ›´å¥½çš„ React ç”Ÿæ€é›†æˆ
8. **çŠ¶æ€æŒä¹…åŒ–**: URL å‚æ•°ä¿æŒç”¨æˆ·é€‰æ‹©

è¿™ä¸ªä¼˜åŒ–åçš„é¡µé¢ç°åœ¨å…·å¤‡äº†ä¼ä¸šçº§åº”ç”¨æ‰€éœ€çš„æ‰€æœ‰ç‰¹æ€§ï¼Œå¯ä»¥ä½œä¸ºå…¶ä»–é¡µé¢ä¼˜åŒ–çš„å‚è€ƒæ¨¡æ¿ã€‚ 