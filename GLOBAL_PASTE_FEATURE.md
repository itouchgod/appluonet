# 全局粘贴功能说明

## 功能概述

MLUONET系统的报价和订单确认页面支持全局粘贴功能，允许用户从Excel或其他表格软件复制数据后，在页面的任意位置粘贴，系统会自动解析并填充到表格中。

## 支持的列数格式

### 1. 1列格式
**格式**: 产品名称
**示例**:
```
产品A
产品B
产品C
```
**数据映射**:
- 第1列 → `partName`（产品名称）

### 2. 2列格式
**格式**: 产品名称 + 数量
**示例**:
```
产品A	10
产品B	20
产品C	30
```
**数据映射**:
- 第1列 → `partName`（产品名称）
- 第2列 → `quantity`（数量）

### 3. 3列格式（智能识别）
**格式A**: 产品名称 + 描述 + 数量
**示例**:
```
产品A	详细描述	10
产品B	规格说明	20
产品C	技术参数	30
```

**格式B**: 产品名称 + 数量 + 单价
**示例**:
```
产品A	10	100.50
产品B	20	200.00
产品C	30	150.75
```

**智能识别逻辑**:
- 如果第3列是数字 → 格式A（名称 + 描述 + 数量）
- 如果第2列是数字 → 格式B（名称 + 数量 + 单价）

### 4. 4列格式（智能识别）
**格式A**: 产品名称 + 数量 + 单位 + 单价 ⭐ **新增支持**
**示例**:
```
产品A	10	pc	100.50
产品B	20	set	200.00
产品C	30	length	150.75
```

**格式B**: 产品名称 + 描述 + 数量 + 单位
**示例**:
```
产品A	详细描述	10	pc
产品B	规格说明	20	set
产品C	技术参数	30	length
```

**智能识别逻辑**:
- 如果第2列和第4列都是数字 → 格式A（名称 + 数量 + 单位 + 单价）
- 否则 → 格式B（名称 + 描述 + 数量 + 单位）

### 5. 5列或更多格式
**格式**: 产品名称 + 描述 + 数量 + 单位 + 单价
**示例**:
```
产品A	详细描述	10	pc	100.50
产品B	规格说明	20	set	200.00
产品C	技术参数	30	length	150.75
```

## 单位处理

系统支持以下默认单位：
- `pc` (piece)
- `set` 
- `length`

**特殊处理**:
- `pcs` → 自动转换为 `pc`
- 复数形式（如 `pieces`）→ 自动转换为单数形式（`piece`）
- 其他单位保持原样

## 使用方法

### 方法1: 全局粘贴
1. 从Excel复制数据
2. 在页面的任意非输入区域按 `Ctrl+V`（Windows）或 `Cmd+V`（Mac）
3. 系统自动解析并填充数据

### 方法2: 剪贴板按钮
1. 点击页面上的剪贴板按钮
2. 系统自动读取剪贴板内容并解析

### 方法3: 手动输入
1. 当剪贴板访问失败时，系统会显示手动输入对话框
2. 在对话框中粘贴数据
3. 点击确认按钮

## 技术实现

### 核心文件
- `src/utils/excelPasteHandler.ts` - Excel数据解析器
- `src/app/quotation/page.tsx` - 报价页面全局粘贴逻辑
- `src/app/invoice/page.tsx` - 发票页面全局粘贴逻辑

### 智能识别算法
```typescript
// 数字识别函数
function isNumeric(value: string): boolean {
  if (!value) return false;
  const num = value.trim().replace(/,/g, '');
  return !isNaN(Number(num)) && num.length > 0;
}

// 4列格式智能识别
if (row.length === 4) {
  if (isNumeric(row[1]) && isNumeric(row[3])) {
    // 格式A: 名称 + 数量 + 单位 + 单价
  } else {
    // 格式B: 名称 + 描述 + 数量 + 单位
  }
}
```

## 注意事项

1. **数据格式**: 确保Excel数据使用制表符（Tab）分隔列
2. **数字格式**: 数量字段应为整数，单价字段支持小数
3. **空行处理**: 系统会自动过滤完全空白的行
4. **错误处理**: 解析失败时会显示友好的错误提示
5. **兼容性**: 支持从Excel、Google Sheets、Numbers等复制数据

## 更新日志

### 最新更新
- ✅ 新增支持"名称，数量，单位，单价"4列格式
- ✅ 优化智能识别算法，提高识别准确性
- ✅ 增强单位处理逻辑，支持更多单位格式
- ✅ 改进错误处理机制，提供更友好的用户提示 