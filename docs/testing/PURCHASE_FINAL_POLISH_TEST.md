# 采购模块最终打磨自测脚本

## 测试目标
验证采购模块的所有最终打磨功能是否正常工作，确保用户体验的完整性和稳定性。

## 测试环境准备
1. 确保开发服务器正常运行：`npm run dev`
2. 访问采购页面：`http://localhost:3000/purchase`
3. 打开浏览器开发者工具，观察Console输出

## 测试步骤

### 1. 表单绑定升级测试
**目标**: 验证新的表单绑定功能

**步骤**:
1. 新建一单，仅填供应商名
2. 添加1条明细，填写商品描述、数量、单价
3. **预期结果**: 
   - 数量字段右对齐显示
   - 单价字段右对齐显示
   - 即时合计正确计算
   - 错误提示在字段下方显示

### 2. 错误提示组件测试
**目标**: 验证错误提示的显示和消失

**步骤**:
1. 清空供应商名称
2. 清空商品描述
3. 设置数量为0或负数
4. 设置单价为0或负数
5. **预期结果**:
   - 字段下方显示红色错误提示
   - 右侧边栏显示错误汇总
   - 填写正确内容后错误提示消失

### 3. 自动保存功能测试
**目标**: 验证300ms防抖自动保存

**步骤**:
1. 填写供应商信息
2. 快速连续修改多个字段
3. 等待300ms
4. 刷新页面
5. **预期结果**:
   - 数据自动保存到localStorage
   - 刷新后数据恢复
   - 配额不足时降级为轻量保存

### 4. 布尔字段持久化测试
**目标**: 验证checkbox状态的持久化

**步骤**:
1. 勾选"需要开票资料"
2. 刷新页面
3. **预期结果**:
   - checkbox状态保持勾选
   - 数据正确迁移（从字符串到布尔值）

### 5. 快捷键保存测试
**目标**: 验证键盘快捷键功能

**步骤**:
1. 填写必要信息
2. 按 ⌘/Ctrl+S
3. **预期结果**:
   - 触发保存操作
   - 显示"保存成功"toast提示
   - 按钮状态正确更新

### 6. 网络异常处理测试
**目标**: 验证保存失败的错误处理

**步骤**:
1. 断开网络连接
2. 点击保存按钮
3. **预期结果**:
   - 显示"保存失败，请重试"错误提示
   - 页面不崩溃
   - 按钮状态正确恢复

### 7. PDF生成测试
**目标**: 验证PDF负载选择器

**步骤**:
1. 填写完整的采购信息
2. 生成PDF
3. **预期结果**:
   - PDF正确生成
   - 数据结构完整
   - 金额计算正确
   - 无字体/受控警告

### 8. 历史记录加载测试
**目标**: 验证历史数据的加载和计算

**步骤**:
1. 打开历史抽屉
2. 加载一个旧的采购单
3. **预期结果**:
   - 数据正确加载
   - Selector合计正确更新
   - PDF负载数据同步更新

### 9. Store迁移测试
**目标**: 验证版本迁移功能

**步骤**:
1. 在localStorage中手动修改版本号
2. 刷新页面
3. **预期结果**:
   - 数据正确迁移
   - 新字段有默认值
   - 旧数据格式正确转换

### 10. 性能测试
**目标**: 验证页面性能

**步骤**:
1. 添加大量商品条目（50+）
2. 快速切换字段
3. **预期结果**:
   - 页面响应流畅
   - 自动保存不阻塞UI
   - 错误提示实时更新

## 测试结果记录

| 测试项目 | 状态 | 备注 |
|---------|------|------|
| 表单绑定升级 | ⬜ | |
| 错误提示组件 | ⬜ | |
| 自动保存功能 | ⬜ | |
| 布尔字段持久化 | ⬜ | |
| 快捷键保存 | ⬜ | |
| 网络异常处理 | ⬜ | |
| PDF生成 | ⬜ | |
| 历史记录加载 | ⬜ | |
| Store迁移 | ⬜ | |
| 性能测试 | ⬜ | |

## 问题记录

### 发现的问题
1. 
2. 
3. 

### 解决方案
1. 
2. 
3. 

## 测试完成确认

- [ ] 所有测试项目通过
- [ ] 无严重bug发现
- [ ] 用户体验流畅
- [ ] 功能完整性验证
- [ ] 性能指标达标

**测试人员**: ___________  
**测试日期**: ___________  
**测试结果**: 通过/不通过
