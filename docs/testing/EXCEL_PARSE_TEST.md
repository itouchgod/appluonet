# Excel粘贴测试报告

## 🔧 修复内容

### 问题描述
之前的解析器无法正确处理Excel复制时的**单元格内换行符**，导致多行数据被错误分割。

### 解决方案
1. **智能行解析**：区分真正的行分隔符和单元格内的换行符
2. **引号处理**：正确处理Excel的引号包围和转义规则  
3. **Tab优先**：优先使用Tab分隔符解析（Excel标准格式）
4. **文本清理**：自动去除引号包围，处理双引号转义

## 🧪 测试场景

### 场景1：带序号列的Excel表格（Tab分隔）
```
序号	名称	数量	单位	单价
1	苹果	100	pc	2.50
2	橙子	50	kg	3.00
3	香蕉	200	pc	1.50
```
**期望**：自动检测并跳过序号列，正确解析为3行产品数据

### 场景2：基础Excel复制（Tab分隔）
```
名称	数量	单位	单价
苹果	100	pc	2.50
橙子	50	kg	3.00
```
**期望**：正确解析为2行数据

### 场景3：序号列在中间位置
```
名称	编号	数量	单位	单价
苹果	1	100	pc	2.50
橙子	2	50	kg	3.00
```
**期望**：检测到第2列是序号列并跳过

### 场景4：单元格内包含换行符
```
"产品名称
第二行描述"	100	pc	2.50
"另一个产品"	50	kg	3.00
```
**期望**：第一个单元格内的换行符被保留，不会分割成多行

### 场景5：包含描述的5列格式
```
名称	描述	数量	单位	单价
苹果	"新鲜红苹果
口感香甜"	100	pc	2.50
```
**期望**：描述字段的换行符被正确保留

### 场景6：混合引号和特殊字符
```
"产品""特殊""名称"	100	pc	$2.50
普通产品	50	kg	€3,50
```
**期望**：双引号转义、货币符号、小数逗号都被正确处理

## 🚀 技术实现

### 新增函数
1. **`parseCSVLikeText()`**：智能行分割，处理引号内的换行符
2. **`parseRowCells()`**：单行内的单元格分割，处理Tab和引号
3. **`cleanTextContent()`**：文本内容清理，去除引号和转义
4. **`isLikelySequenceNumber()`**：序号识别算法
5. **`detectSequenceColumn()`**：序号列检测逻辑
6. **增强`parseNumberLike()`**：更好的数字识别，支持引号包围

### 置信度提升
- Excel格式（含Tab）自动加12%置信度
- 序号列检测成功加12%置信度  
- 表头识别加12%置信度
- 更准确的格式检测和分类
- 更好的错误容错机制

## ✅ 预期改进

1. **序号列智能跳过**：自动识别并跳过序号列（1,2,3...）
2. **单元格换行不再干扰**：多行描述正确处理
3. **Excel格式完美支持**：标准Tab分隔格式优先识别  
4. **引号处理准确**：包含引号、逗号、换行的单元格正确解析
5. **置信度更高**：Excel格式+序号检测获得更高的自动插入概率
6. **向下兼容**：仍支持逗号、分号等其他分隔符

这个修复让解析器真正"智能"起来，能够像Excel一样正确理解复制的表格数据！
