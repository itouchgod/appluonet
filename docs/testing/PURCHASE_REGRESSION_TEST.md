# 采购模块回归测试清单

## 测试环境
- 开发服务器：`npm run dev`
- 访问地址：`http://localhost:3000/purchase`
- 浏览器：Chrome/Firefox/Safari

## 回归测试用例（10条）

### 1. 基础功能测试
**测试目标**: 仅填供应商名 + 1 条明细 → 合计正确、PDF 生成正常

**测试步骤**:
1. 访问采购页面
2. 填写供应商名称
3. 添加1条商品明细，填写描述、数量、单价
4. 观察右侧合计是否正确计算
5. 点击"生成PDF"按钮

**预期结果**:
- ✅ 合计金额正确显示
- ✅ PDF生成成功，无错误
- ✅ PDF内容完整，格式正确

---

### 2. 键盘导航测试
**测试目标**: Qty/Price 用键盘 Enter 快速录入下一格；ArrowDown 到下一行

**测试步骤**:
1. 在商品描述字段输入内容
2. 按 Enter 键
3. 观察焦点是否移动到数量字段
4. 输入数量后按 Enter
5. 继续按 Enter 直到单价字段
6. 在单价字段按 Enter，观察是否移动到下一行的描述字段
7. 测试 ArrowDown 键在行间移动

**预期结果**:
- ✅ Enter 键在单元格间正确移动
- ✅ ArrowDown 键在行间正确移动
- ✅ 焦点移动时自动选中内容

---

### 3. 布尔字段持久化测试
**测试目标**: 勾选 "Need invoice information" → 刷新后仍为勾选状态（v3 迁移为 boolean 生效）

**测试步骤**:
1. 在银行信息区域勾选"需要开票资料"
2. 刷新页面
3. 观察checkbox状态

**预期结果**:
- ✅ 刷新后checkbox保持勾选状态
- ✅ 数据正确从字符串迁移到布尔值

---

### 4. 货币切换测试
**测试目标**: Currency 切换为 EUR → 合计展示币种变化

**测试步骤**:
1. 在订单设置中选择货币为 EUR
2. 添加商品明细
3. 观察合计显示

**预期结果**:
- ✅ 货币切换生效
- ✅ 合计显示正确的货币符号

---

### 5. 快捷键保存测试
**测试目标**: ⌘/Ctrl+S 保存 → 成功 toast；断网/模拟异常 → 错误 toast

**测试步骤**:
1. 填写必要信息
2. 按 ⌘/Ctrl+S 快捷键
3. 观察是否显示"保存成功"toast
4. 模拟网络异常（开发者工具断网）
5. 再次按 ⌘/Ctrl+S
6. 观察是否显示"保存失败"toast

**预期结果**:
- ✅ 快捷键触发保存
- ✅ 成功时显示绿色toast
- ✅ 失败时显示红色toast

---

### 6. 历史搜索测试
**测试目标**: History 搜索按供应商关键字能过滤正确

**测试步骤**:
1. 打开历史抽屉
2. 在搜索框输入供应商名称关键字
3. 观察列表过滤结果
4. 测试按PO号搜索
5. 测试按标题搜索

**预期结果**:
- ✅ 搜索框正确过滤结果
- ✅ 支持供应商名称、PO号、标题搜索
- ✅ 无结果时显示"No results"

---

### 7. 复制和编辑功能测试
**测试目标**: copy/[id] → 清空 PO No；edit/[id] → 正确加载并可继续编辑

**测试步骤**:
1. 保存一个采购单
2. 访问 copy/[id] 页面
3. 观察PO号是否被清空
4. 访问 edit/[id] 页面
5. 观察数据是否正确加载
6. 修改内容并保存

**预期结果**:
- ✅ 复制时PO号被清空
- ✅ 编辑时数据正确加载
- ✅ 可以正常修改和保存

---

### 8. 自动保存测试
**测试目标**: Autosave：输入停 300ms，刷新仍保留最近输入（或 slim 存档）

**测试步骤**:
1. 填写供应商信息
2. 快速连续修改多个字段
3. 等待300ms
4. 刷新页面
5. 观察数据是否恢复

**预期结果**:
- ✅ 数据自动保存到localStorage
- ✅ 刷新后数据恢复
- ✅ 配额不足时降级为轻量保存

---

### 9. 字段验证测试
**测试目标**: 校验：删除明细的描述或把 Qty=0 → 显示字段级错误

**测试步骤**:
1. 清空商品描述
2. 观察是否显示红色错误提示
3. 设置数量为0
4. 观察是否显示红色错误提示
5. 设置单价为0
6. 观察是否显示红色错误提示
7. 填写正确内容
8. 观察错误提示是否消失

**预期结果**:
- ✅ 字段下方显示红色错误提示
- ✅ 右侧边栏显示错误汇总
- ✅ 填写正确后错误提示消失

---

### 10. 构建测试
**测试目标**: 构建：`npm run build` 无 React 受控告警/字体告警

**测试步骤**:
1. 运行 `npm run build`
2. 观察控制台输出
3. 检查是否有警告信息

**预期结果**:
- ✅ 构建成功，无错误
- ✅ 无React受控告警
- ✅ 无字体告警
- ✅ 无TypeScript类型错误

---

## 测试结果记录

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 基础功能测试 | ⬜ | |
| 键盘导航测试 | ⬜ | |
| 布尔字段持久化测试 | ⬜ | |
| 货币切换测试 | ⬜ | |
| 快捷键保存测试 | ⬜ | |
| 历史搜索测试 | ⬜ | |
| 复制和编辑功能测试 | ⬜ | |
| 自动保存测试 | ⬜ | |
| 字段验证测试 | ⬜ | |
| 构建测试 | ⬜ | |

## 问题记录

### 发现的问题
1. 
2. 
3. 

### 解决方案
1. 
2. 
3. 

## 测试完成确认

- [ ] 所有测试用例通过
- [ ] 无严重bug发现
- [ ] 用户体验流畅
- [ ] 功能完整性验证
- [ ] 性能指标达标
- [ ] 构建无警告

**测试人员**: ___________  
**测试日期**: ___________  
**测试结果**: 通过/不通过

## 新功能验证

### 键盘导航功能
- [ ] Enter键在单元格间正确移动
- [ ] ArrowUp/ArrowDown在行间正确移动
- [ ] 焦点移动时自动选中内容

### 历史搜索功能
- [ ] 搜索框正确过滤结果
- [ ] 支持多字段搜索（标题、PO号、供应商）
- [ ] 无结果时显示正确提示

### Toast提示系统
- [ ] 保存成功显示绿色toast
- [ ] 保存失败显示红色toast
- [ ] Toast自动消失

### 自动保存功能
- [ ] 300ms防抖正常工作
- [ ] 数据正确保存到localStorage
- [ ] 配额不足时降级保存
