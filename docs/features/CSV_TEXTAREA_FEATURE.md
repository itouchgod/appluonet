# CSV文本框功能说明

## 功能概述

在采购模块的规格描述文本框中，新增了支持制表符和CSV格式的功能，让用户可以更方便地输入和编辑表格数据。

## 主要特性

### 1. 制表符支持
- 按Tab键可以在单元格间快速跳转
- 支持手动输入制表符来创建表格结构
- 自动处理制表符的插入和光标定位

### 2. CSV格式支持
- 支持粘贴Excel数据，自动识别CSV格式
- 兼容制表符分隔和逗号分隔的数据
- 自动解析并转换为标准格式
- 智能分隔符检测，支持制表符、逗号、分号、竖线等
- 即见即所得粘贴，支持多种表格软件格式

### 3. 内嵌表格编辑器
- 直接在页面中显示表格编辑器，无需弹窗
- 在表格中直观地编辑数据
- 支持添加/删除行和列
- 实时同步数据
- 提供快速粘贴按钮，一键从剪贴板读取表格数据
- 粘贴后立即在编辑器中显示

### 4. 长文本优化
- 支持单元格内容自动换行
- 列宽根据内容自适应调整
- 行高根据内容自动调整
- 最小和最大列宽限制，确保表格美观

### 5. 合并单元格支持
- 支持选择多个单元格进行合并
- 支持跨行和跨列合并
- 合并的单元格在表格视图中高亮显示
- 支持取消合并操作
- PDF中正确显示合并单元格的跨行跨列效果
- **智能识别**：自动检测Excel中的空单元格合并结构
- **真实还原**：正确识别从Excel复制的包含合并单元格的数据

### 6. PDF渲染优化
- PDF预览中表格正确显示边框和格式
- 支持中文长文本的正确换行
- 表格自动分页，避免内容被截断
- 表头使用粗体显示，数据行使用正常字体
- 支持合并单元格的跨行跨列显示

### 7. 用户友好的界面
- 提供清晰的操作提示
- 支持深色模式
- 响应式设计，适配不同屏幕尺寸

## 使用方法

### 基本操作
1. **直接编辑**：在表格中直接点击单元格进行编辑
2. **粘贴Excel数据**：从Excel复制数据，点击"📋 粘贴表格"按钮
3. **添加行/列**：点击"➕ 添加行"或"➕ 添加列"按钮
4. **删除行/列**：点击行或列末尾的删除按钮
5. **合并单元格**：选择多个单元格，点击"🔗 合并"按钮
6. **取消合并**：选择合并的单元格，点击"🔓 取消合并"按钮



### 示例数据格式

#### 基础表格
```
产品名称	规格	数量	单价	备注
螺丝	M3x10	100	0.5	不锈钢
螺母	M3	100	0.3	配套使用
垫片	M3	200	0.1	防松动
```

#### 合并单元格表格
```
产品类别	规格	数量	单价	备注
紧固件	M3系列	300	0.3	包含螺丝、螺母、垫片
	M4系列	200	0.4	包含螺丝、螺母、垫片
	M5系列	150	0.6	包含螺丝、螺母、垫片
机械零件	弹簧	50	1.2	压缩弹簧
	轴承	20	8.5	深沟球轴承
	密封圈	80	0.8	O型密封圈
```

#### 真实Excel数据（包含空单元格合并）
```
Line No.	Description	Q'TY	Unit	U/Price	Amount	D/T
	Maker: Shang					
	BRAND NEW .					
1	TEMPERATUR	2	PCS	439.00	878.00	STOCK
	Packing and h					
	TOTAL AMOU		878.00		
```

## 技术实现

### 组件结构
- `CSVTextarea.tsx`：主要的CSV文本框组件
- 集成到采购表单的规格描述字段

### 核心功能
1. **CSV解析**：`parseCSV()` 函数处理不同格式的CSV数据
2. **表格转换**：`tableToCSV()` 函数将表格数据转换回文本格式
3. **事件处理**：处理粘贴、键盘输入等用户交互
4. **状态管理**：管理文本框和表格视图的状态同步
5. **PDF表格渲染**：`renderTableInPDF()` 函数在PDF中正确渲染表格
6. **自适应布局**：根据内容自动调整列宽和行高

### 兼容性
- 支持现代浏览器
- 兼容深色模式
- 响应式设计
- 无障碍访问支持

## 测试

可以通过访问 `/test-csv` 页面来测试CSV文本框功能：

1. 启动开发服务器：`npm run dev`
2. 访问：`http://localhost:3000/test-csv`
3. 测试各种功能：
   - 直接输入制表符
   - 粘贴Excel数据
   - 切换表格视图
   - 编辑表格数据

## 未来改进

1. **更多格式支持**：支持更多CSV变体和分隔符
2. **数据验证**：添加数据类型验证和格式检查
3. **导入导出**：支持直接导入/导出Excel文件
4. **样式定制**：提供更多表格样式选项
5. **快捷键**：添加更多快捷键支持

## 相关文件

- `src/components/ui/CSVTextarea.tsx` - CSV文本框组件
- `src/features/purchase/components/PurchaseForm.tsx` - 采购表单集成
- `src/app/test-csv/page.tsx` - 测试页面
