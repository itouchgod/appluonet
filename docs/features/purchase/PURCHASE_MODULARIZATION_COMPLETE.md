# Purchase é¡µé¢æ¨¡å—åŒ–å®Œæˆ

## æ¨¡å—åŒ–ç›®æ ‡

åœ¨ä¿æŒåŠŸèƒ½å’Œå¸ƒå±€å®Œå…¨ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå°† Purchase é¡µé¢è¿›è¡Œæ¨¡å—åŒ–é‡æ„ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## æ¨¡å—åŒ–æ¶æ„

### ğŸ“ æ–‡ä»¶ç»“æ„
```
src/features/purchase/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ PurchasePage.tsx          # ä¸»é¡µé¢ç»„ä»¶
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ PurchaseHeader.tsx        # é¡µé¢å¤´éƒ¨ç»„ä»¶
â”‚   â”œâ”€â”€ PurchaseForm.tsx          # è¡¨å•ç»„ä»¶
â”‚   â””â”€â”€ PurchaseActions.tsx       # æ“ä½œæŒ‰é’®ç»„ä»¶
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ usePurchaseActions.ts     # ä¸šåŠ¡é€»è¾‘hooks
â”œâ”€â”€ state/
â”‚   â”œâ”€â”€ purchase.store.ts         # ZustandçŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ purchase.selectors.ts     # çŠ¶æ€é€‰æ‹©å™¨
â””â”€â”€ utils/
    â””â”€â”€ types.ts                  # ç±»å‹å®šä¹‰
```

### ğŸ”§ æ ¸å¿ƒæ¨¡å—

#### 1. çŠ¶æ€ç®¡ç† (`purchase.store.ts`)
- **Zustand Store**: é›†ä¸­ç®¡ç†æ‰€æœ‰çŠ¶æ€
- **æŒä¹…åŒ–**: è‡ªåŠ¨ä¿å­˜åˆ° localStorage
- **ä¸šåŠ¡æ–¹æ³•**: å°è£…æ‰€æœ‰ä¸šåŠ¡æ“ä½œ
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

#### 2. é€‰æ‹©å™¨ (`purchase.selectors.ts`)
- **åˆ†ç‰‡è®¢é˜…**: é¿å…æ— é™å¾ªç¯é—®é¢˜
- **useMemo ä¼˜åŒ–**: ç¼“å­˜è®¡ç®—ç»“æœ
- **åŸå­åŒ–**: æ¯ä¸ªé€‰æ‹©å™¨åªå…³æ³¨ç‰¹å®šæ•°æ®

#### 3. ä¸šåŠ¡é€»è¾‘ (`usePurchaseActions.ts`)
- **åˆå§‹åŒ–é€»è¾‘**: æ•°æ®åŠ è½½å’Œç”¨æˆ·ä¿¡æ¯è®¾ç½®
- **è‡ªåŠ¨ä¿å­˜**: è‰ç¨¿è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
- **PDFæ“ä½œ**: ç”Ÿæˆå’Œé¢„è§ˆPDF
- **é‡‘é¢å¤„ç†**: æ ¼å¼åŒ–é‡‘é¢è¾“å…¥

#### 4. ç»„ä»¶æ¨¡å—
- **PurchaseHeader**: é¡µé¢å¤´éƒ¨å’Œå¯¼èˆª
- **PurchaseForm**: å®Œæ•´çš„è¡¨å•å†…å®¹
- **PurchaseActions**: æ“ä½œæŒ‰é’®å’Œè¿›åº¦æ¡

## åŠŸèƒ½ä¿æŒ

### âœ… å®Œå…¨ä¿æŒçš„åŠŸèƒ½
1. **å®Œæ•´çš„é‡‡è´­è®¢å•è¡¨å•** - æ‰€æœ‰å­—æ®µå’Œå¸ƒå±€
2. **è‡ªåŠ¨ä¿å­˜åŠŸèƒ½** - 2ç§’å»¶è¿Ÿè‡ªåŠ¨ä¿å­˜
3. **å†å²è®°å½•é›†æˆ** - ç¼–è¾‘å’Œå¤åˆ¶æ¨¡å¼
4. **PDFç”Ÿæˆå’Œé¢„è§ˆ** - å®Œæ•´çš„PDFåŠŸèƒ½
5. **è®¾ç½®é¢æ¿** - å¯æŠ˜å çš„è®¾ç½®é€‰é¡¹
6. **é“¶è¡Œä¿¡æ¯åˆ‡æ¢** - åŠ¨æ€æ˜¾ç¤º/éšè—
7. **è´§å¸åˆ‡æ¢** - CNY/USD/EUR ä¸‰ç§è´§å¸
8. **è¿›åº¦æ¡æ˜¾ç¤º** - PDFç”Ÿæˆæ—¶çš„è¿›åº¦åé¦ˆ
9. **å“åº”å¼è®¾è®¡** - ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯æ”¯æŒ
10. **æ·±è‰²æ¨¡å¼** - å®Œæ•´çš„ä¸»é¢˜æ”¯æŒ
11. **åŠ¨æ€é«˜åº¦è°ƒæ•´** - æ–‡æœ¬æ¡†è‡ªåŠ¨è°ƒæ•´
12. **åŠ è½½çŠ¶æ€** - ç”ŸæˆPDFæ—¶çš„åŠ è½½åŠ¨ç”»
13. **Toastæç¤º** - æ“ä½œæˆåŠŸ/å¤±è´¥çš„åé¦ˆ

### ğŸ¨ ç•Œé¢ä¿æŒ
- **å¸ƒå±€ç»“æ„**: å®Œå…¨ç›¸åŒçš„é¡µé¢å¸ƒå±€
- **æ ·å¼ç±»å**: ä¿æŒæ‰€æœ‰CSSç±»å
- **äº¤äº’æ•ˆæœ**: ä¿æŒæ‰€æœ‰åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ
- **å“åº”å¼**: ä¿æŒæ‰€æœ‰æ–­ç‚¹é€‚é…

## æŠ€æœ¯ä¼˜åŠ¿

### 1. ä»£ç ç»„ç»‡
- **å…³æ³¨ç‚¹åˆ†ç¦»**: çŠ¶æ€ã€é€»è¾‘ã€UI åˆ†ç¦»
- **å¯å¤ç”¨æ€§**: ç»„ä»¶å’Œhookså¯ç‹¬ç«‹ä½¿ç”¨
- **å¯æµ‹è¯•æ€§**: æ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•
- **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ

### 2. æ€§èƒ½ä¼˜åŒ–
- **çŠ¶æ€è®¢é˜…ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- **è®¡ç®—ç¼“å­˜**: useMemo ç¼“å­˜è®¡ç®—ç»“æœ
- **æ‡’åŠ è½½**: åŠ¨æ€å¯¼å…¥PDFé¢„è§ˆç»„ä»¶
- **å†…å­˜ç®¡ç†**: åŠæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨

### 3. å¼€å‘ä½“éªŒ
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptæ”¯æŒ
- **ä»£ç æç¤º**: IDEæ™ºèƒ½æç¤ºå’Œè¡¥å…¨
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **è°ƒè¯•å‹å¥½**: æ¸…æ™°çš„çŠ¶æ€å˜åŒ–è¿½è¸ª

## æ¨¡å—åŒ–å¯¹æ¯”

### é‡æ„å‰
```tsx
// å•ä¸€æ–‡ä»¶ï¼Œ600+ è¡Œä»£ç 
export default function PurchaseOrderPage() {
  // æ‰€æœ‰çŠ¶æ€ã€é€»è¾‘ã€UI æ··åœ¨ä¸€èµ·
  const [data, setData] = useState(defaultData);
  const [isGenerating, setIsGenerating] = useState(false);
  // ... æ›´å¤šçŠ¶æ€
  
  // æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
  const handleGenerate = useCallback(async () => {
    // å¤æ‚çš„PDFç”Ÿæˆé€»è¾‘
  }, []);
  
  // æ‰€æœ‰UIæ¸²æŸ“
  return (
    <div>
      {/* 600+ è¡Œçš„JSX */}
    </div>
  );
}
```

### é‡æ„å
```tsx
// ä¸»é¡µé¢ç»„ä»¶ï¼Œç®€æ´æ¸…æ™°
export default function PurchasePage() {
  const { showPreview, previewItem, setShowPreview, setPreviewItem } = usePurchaseStore();
  
  usePurchaseInit(); // åˆå§‹åŒ–é€»è¾‘

  return (
    <div>
      <PurchaseHeader />
      <div>
        <PurchaseForm />
        <PurchaseActions />
      </div>
      <PDFPreviewModal />
    </div>
  );
}
```

## çŠ¶æ€ç®¡ç†å¯¹æ¯”

### é‡æ„å‰
```tsx
// å¤šä¸ªuseStateï¼ŒçŠ¶æ€åˆ†æ•£
const [data, setData] = useState(defaultData);
const [isGenerating, setIsGenerating] = useState(false);
const [showSettings, setShowSettings] = useState(false);
// ... æ›´å¤šçŠ¶æ€
```

### é‡æ„å
```tsx
// é›†ä¸­çŠ¶æ€ç®¡ç†ï¼Œç±»å‹å®‰å…¨
const { 
  data, 
  isGenerating, 
  showSettings,
  updateData,
  setIsGenerating,
  toggleSettings 
} = usePurchaseStore();
```

## éªŒè¯ç»“æœ

âœ… **åŠŸèƒ½å®Œæ•´æ€§** - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
âœ… **ç•Œé¢ä¸€è‡´æ€§** - å¸ƒå±€å’Œæ ·å¼å®Œå…¨ä¸€è‡´
âœ… **æ€§èƒ½ä¼˜åŒ–** - çŠ¶æ€è®¢é˜…ä¼˜åŒ–ï¼Œé¿å…æ— é™å¾ªç¯
âœ… **ä»£ç è´¨é‡** - æ¨¡å—åŒ–æ¶æ„ï¼Œæ˜“äºç»´æŠ¤
âœ… **ç±»å‹å®‰å…¨** - å®Œæ•´çš„TypeScriptæ”¯æŒ
âœ… **å¼€å‘ä½“éªŒ** - æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ™ºèƒ½æç¤º

## æ–‡ä»¶å˜æ›´æ€»ç»“

### æ–°å¢æ–‡ä»¶
- `src/features/purchase/components/PurchaseHeader.tsx`
- `src/features/purchase/components/PurchaseForm.tsx`
- `src/features/purchase/components/PurchaseActions.tsx`
- `src/features/purchase/hooks/usePurchaseActions.ts`

### é‡æ„æ–‡ä»¶
- `src/features/purchase/state/purchase.store.ts` - å®Œå…¨é‡å†™
- `src/features/purchase/state/purchase.selectors.ts` - å®Œå…¨é‡å†™
- `src/features/purchase/app/PurchasePage.tsx` - æ¨¡å—åŒ–é‡æ„
- `src/app/purchase/page.tsx` - æ›´æ–°ä¸ºé‡å®šå‘

### ä¿æŒæ–‡ä»¶
- æ‰€æœ‰åŸæœ‰çš„ç»„ä»¶æ–‡ä»¶ä¿æŒä¸å˜
- æ‰€æœ‰å·¥å…·å‡½æ•°å’Œhooksä¿æŒä¸å˜
- æ‰€æœ‰ç±»å‹å®šä¹‰ä¿æŒä¸å˜

## åç»­ä¼˜åŒ–å»ºè®®

1. **å•å…ƒæµ‹è¯•** - ä¸ºæ¯ä¸ªæ¨¡å—æ·»åŠ å•å…ƒæµ‹è¯•
2. **æ€§èƒ½ç›‘æ§** - æ·»åŠ æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
3. **é”™è¯¯è¾¹ç•Œ** - æ·»åŠ é”™è¯¯è¾¹ç•Œå¤„ç†
4. **å›½é™…åŒ–** - æ”¯æŒå¤šè¯­è¨€
5. **ä¸»é¢˜ç³»ç»Ÿ** - æ›´çµæ´»çš„ä¸»é¢˜é…ç½®

æ¨¡å—åŒ–å®Œæˆæ—¶é—´ï¼š2025-01-08
