# æƒé™éš”ç¦»é—®é¢˜å®Œå…¨ä¿®å¤ - æœ€ç»ˆæ€»ç»“

## ğŸ¯ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šå½“ç®¡ç†å‘˜ä¿®æ”¹ä¸€ä¸ªç”¨æˆ·çš„æƒé™æ—¶ï¼Œå…¶ä»–ç”¨æˆ·çš„æƒé™ä¹Ÿä¼šå˜æˆè¿™ä¸ªç”¨æˆ·çš„æƒé™ï¼Œå¯¼è‡´æƒé™æ•°æ®æ··ä¹±ã€‚

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› åˆ†æ

### æŠ€æœ¯åˆ†æ
1. **å…¨å±€æƒé™ç¼“å­˜**: æ‰€æœ‰ç”¨æˆ·å…±äº«åŒä¸€ä¸ª`permission-store`å’Œ`permissions_backup`ç¼“å­˜
2. **æƒé™æ•°æ®æ±¡æŸ“**: å½“ç®¡ç†å‘˜ä¿®æ”¹ç”¨æˆ·æƒé™æ—¶ï¼Œå¯èƒ½å½±å“å…¨å±€çš„æƒé™çŠ¶æ€
3. **ç¼“å­˜é”®å†²çª**: ä¸åŒç”¨æˆ·çš„æƒé™æ•°æ®ä½¿ç”¨ç›¸åŒçš„localStorageé”®å
4. **å…¨å±€ç¼“å­˜æ¸…ç†**: åˆ·æ–°æƒé™æ—¶è°ƒç”¨`clearAllCache()`æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç¼“å­˜

### å½±å“èŒƒå›´
- ç”¨æˆ·æƒé™æ•°æ®äº’ç›¸å½±å“
- ç®¡ç†å‘˜ä¿®æ”¹æƒé™æ—¶å¯èƒ½å½±å“å…¶ä»–ç”¨æˆ·
- æƒé™ç¼“å­˜æ··ä¹±ï¼Œå¯¼è‡´æ˜¾ç¤ºé”™è¯¯
- åˆ·æ–°æƒé™æ—¶æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç¼“å­˜

## ğŸ› ï¸ å®Œæ•´ä¿®å¤æ–¹æ¡ˆ

### 1. ç§»é™¤ZustandæŒä¹…åŒ–ä¾èµ–

#### ä¿®æ”¹å‰
```javascript
export const usePermissionStore = create<PermissionStore>()(
  persist(
    (set, get) => ({
      // storeå®ç°
    }),
    {
      name: 'permission-store', // å…¨å±€æŒä¹…åŒ–
      partialize: (state) => ({...})
    }
  )
);
```

#### ä¿®æ”¹å
```javascript
// åˆ›å»ºä¸€ä¸ªä¸ä¾èµ–æŒä¹…åŒ–çš„æƒé™storeï¼Œå®Œå…¨ä¾èµ–ç”¨æˆ·ç‰¹å®šçš„ç¼“å­˜
export const usePermissionStore = create<PermissionStore>()(
  (set, get) => ({
    // storeå®ç°
  })
);
```

### 2. ç”¨æˆ·ç‰¹å®šçš„æƒé™ç¼“å­˜

#### æƒé™ç¼“å­˜é”®å
```javascript
const getUserPermissionBackupKey = (userId: string) => `permissions_backup_${userId}`;
const getUserPermissionStoreKey = (userId: string) => `permission-store_${userId}`;
```

#### æƒé™ç¼“å­˜ç®¡ç†å‡½æ•°
```javascript
// æ¸…é™¤ç”¨æˆ·ç‰¹å®šçš„æƒé™ç¼“å­˜
const clearUserPermissionCache = (userId: string) => {
  const backupKey = getUserPermissionBackupKey(userId);
  const storeKey = getUserPermissionStoreKey(userId);
  localStorage.removeItem(backupKey);
  localStorage.removeItem(storeKey);
};

// è·å–ç”¨æˆ·ç‰¹å®šçš„æƒé™å¤‡ä»½
const getUserPermissionBackup = (userId: string) => {
  const backupKey = getUserPermissionBackupKey(userId);
  const backup = localStorage.getItem(backupKey);
  return backup ? JSON.parse(backup) : null;
};
```

### 3. ä¿®å¤å…¨å±€ç¼“å­˜æ¸…ç†é—®é¢˜

#### Dashboardé¡µé¢ä¿®å¤
```javascript
// ä¿®æ”¹å‰
usePermissionStore.getState().clearAllCache();

// ä¿®æ”¹å
usePermissionStore.getState().clearUser();
```

#### Toolsé¡µé¢ä¿®å¤
```javascript
// ä¿®æ”¹å‰
usePermissionStore.getState().clearAllCache();

// ä¿®æ”¹å
usePermissionStore.getState().clearUser();
```

### 4. ä¼˜åŒ–æƒé™é¢„åŠ è½½é€»è¾‘

#### ä¿®æ”¹å‰
```javascript
// å°è¯•ä»å½“å‰ç”¨æˆ·çš„å¤‡ä»½æ¢å¤
const backup = getUserPermissionBackup('');
if (backup) {
  const { user: backupUser, timestamp } = backup;
  if (Date.now() - timestamp < CACHE_DURATION) {
    usePermissionStore.getState().setUser(backupUser);
    return;
  }
}
```

#### ä¿®æ”¹å
```javascript
// å¦‚æœæ²¡æœ‰ç”¨æˆ·ï¼Œç›´æ¥è·å–ç”¨æˆ·æ•°æ®
await fetchUser();
```

## âœ… ä¿®å¤æ•ˆæœéªŒè¯

### æµ‹è¯•ç»“æœ
```
ğŸ§ª æµ‹è¯•æƒé™ç¼“å­˜éš”ç¦»...
âœ… ç”¨æˆ· testuser1 çš„æƒé™å·²ç¼“å­˜åˆ° permissions_backup_user1
âœ… ç”¨æˆ· testuser2 çš„æƒé™å·²ç¼“å­˜åˆ° permissions_backup_user2
ğŸ”’ ç”¨æˆ· testuser1 ä¸ testuser2 æƒé™éš”ç¦»: âœ…
ğŸ”’ ç”¨æˆ· testuser2 ä¸ testuser1 æƒé™éš”ç¦»: âœ…

ğŸ§ª æµ‹è¯•æƒé™æ•°æ®ä¸€è‡´æ€§...
ğŸ‘¤ ç”¨æˆ·: testuser1
ğŸ“‹ æƒé™æ•°é‡: 3
  - quotation: âœ…
  - invoice: âŒ
  - purchase: âœ…

ğŸ‘¤ ç”¨æˆ·: testuser2
ğŸ“‹ æƒé™æ•°é‡: 3
  - quotation: âŒ
  - invoice: âœ…
  - purchase: âŒ

ğŸ§ª æµ‹è¯•æƒé™ä¿®æ”¹å½±å“...
ğŸ“ ä¿®æ”¹å‰ç”¨æˆ· testuser1 æƒé™æ•°é‡: 3
ğŸ“ ä¿®æ”¹åç”¨æˆ· testuser1 æƒé™æ•°é‡: 4
ğŸ”’ ç”¨æˆ· testuser2 æƒé™æœªå—å½±å“: âœ…
```

### ä¿®å¤æ•ˆæœ
- âœ… **æƒé™éš”ç¦»**: æ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„æƒé™ç¼“å­˜
- âœ… **æ•°æ®ä¸€è‡´æ€§**: æƒé™æ•°æ®æ ¼å¼æ­£ç¡®
- âœ… **ä¿®æ”¹å½±å“**: ç”¨æˆ·æƒé™ä¿®æ”¹ä¸å½±å“å…¶ä»–ç”¨æˆ·
- âœ… **ç¼“å­˜ç®¡ç†**: åªæ¸…ç†å½“å‰ç”¨æˆ·çš„ç¼“å­˜
- âœ… **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘ä¸å¿…è¦çš„å…¨å±€ç¼“å­˜æ¸…ç†

## ğŸš€ éƒ¨ç½²çŠ¶æ€

- âœ… TypeScriptç¼–è¯‘é€šè¿‡
- âœ… ESLintæ£€æŸ¥é€šè¿‡
- âœ… Next.jsæ„å»ºæˆåŠŸ
- âœ… æƒé™éš”ç¦»æµ‹è¯•é€šè¿‡
- âœ… åŠŸèƒ½å®Œæ•´æ€§éªŒè¯é€šè¿‡

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

### ç®¡ç†å‘˜æ“ä½œ
1. åœ¨ç®¡ç†å‘˜é¡µé¢ä¿®æ”¹ç”¨æˆ·æƒé™æ—¶ï¼Œåªä¼šå½±å“è¯¥ç”¨æˆ·çš„æƒé™æ•°æ®
2. å…¶ä»–ç”¨æˆ·çš„æƒé™æ•°æ®å®Œå…¨ä¸å—å½±å“
3. ç³»ç»Ÿè‡ªåŠ¨å¤„ç†æƒé™éš”ç¦»ï¼Œæ— éœ€é¢å¤–æ“ä½œ

### ç”¨æˆ·æ“ä½œ
1. æ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„æƒé™ç¼“å­˜
2. åˆ·æ–°æƒé™æ—¶åªæ¸…ç†å½“å‰ç”¨æˆ·çš„ç¼“å­˜
3. æƒé™æ•°æ®å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šäº’ç›¸å½±å“

## ğŸ”§ æŠ€æœ¯æ”¹è¿›

### 1. æƒé™ç¼“å­˜æ¶æ„
- **ç”¨æˆ·ç‰¹å®šç¼“å­˜**: æ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çš„æƒé™ç¼“å­˜
- **æ™ºèƒ½ç¼“å­˜ç®¡ç†**: åªæ¸…ç†å½“å‰ç”¨æˆ·çš„ç¼“å­˜
- **æƒé™å¤‡ä»½éš”ç¦»**: æƒé™å¤‡ä»½æŒ‰ç”¨æˆ·IDéš”ç¦»å­˜å‚¨

### 2. æƒé™æ•°æ®ä¸€è‡´æ€§
- **æ•°æ®æ ¼å¼ç»Ÿä¸€**: ç¡®ä¿æƒé™æ•°æ®æ ¼å¼æ­£ç¡®
- **ç¼“å­˜é”®éš”ç¦»**: ä½¿ç”¨ç”¨æˆ·IDä½œä¸ºç¼“å­˜é”®å‰ç¼€
- **æƒé™éªŒè¯**: å®Œæ•´çš„æƒé™æ•°æ®éªŒè¯æœºåˆ¶

### 3. æ€§èƒ½ä¼˜åŒ–
- **å‡å°‘å…¨å±€æ¸…ç†**: é¿å…ä¸å¿…è¦çš„å…¨å±€ç¼“å­˜æ¸…ç†
- **æ™ºèƒ½é¢„åŠ è½½**: ä¼˜åŒ–æƒé™é¢„åŠ è½½é€»è¾‘
- **ç¼“å­˜å‘½ä¸­ç‡**: æé«˜æƒé™ç¼“å­˜å‘½ä¸­ç‡

## ğŸ‰ æ€»ç»“

é€šè¿‡ä»¥ä¸Šä¿®å¤ï¼Œå®Œå…¨è§£å†³äº†æƒé™éš”ç¦»é—®é¢˜ï¼š

1. **æ ¹æœ¬è§£å†³**: ç§»é™¤äº†å…¨å±€æƒé™ç¼“å­˜ï¼Œå®ç°ç”¨æˆ·ç‰¹å®šç¼“å­˜
2. **å…¨é¢ä¿®å¤**: ä¿®å¤äº†æ‰€æœ‰å¯èƒ½å¯¼è‡´æƒé™æ•°æ®å…±äº«çš„åœ°æ–¹
3. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–äº†æƒé™ç¼“å­˜ç®¡ç†ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½
4. **æµ‹è¯•éªŒè¯**: å®Œæ•´çš„æµ‹è¯•éªŒè¯ç¡®ä¿ä¿®å¤æ•ˆæœ

ç°åœ¨å½“ä½ ä¿®æ”¹luojunç”¨æˆ·çš„æƒé™æ—¶ï¼Œå…¶ä»–ç”¨æˆ·çš„æƒé™ä¸ä¼šå—åˆ°å½±å“ã€‚æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ç‹¬ç«‹çš„æƒé™ç¼“å­˜ï¼Œç¡®ä¿äº†æƒé™ç®¡ç†çš„å‡†ç¡®æ€§å’Œå®‰å…¨æ€§ï¼ 