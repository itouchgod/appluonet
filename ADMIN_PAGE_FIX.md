# ç®¡ç†åå°é¡µé¢ä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šç‚¹å‡»è¿›å…¥ç®¡ç†åå°é¡µé¢æ—¶å‡ºç° 404 é”™è¯¯ï¼š
```
Failed to load resource: the server responded with a status of 404 ()
Error fetching users: Error: HTTP 404
```

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
1. **API è·¯å¾„ä¸åŒ¹é…**ï¼šå‰ç«¯è¯·æ±‚çš„è·¯å¾„ä¸ Worker ä¸­çš„è·¯ç”±é…ç½®ä¸ä¸€è‡´
2. **æ•°æ®æ ¼å¼ä¸åŒ¹é…**ï¼šAPI è¿”å›çš„æ•°æ®æ ¼å¼ä¸å‰ç«¯æœŸæœ›çš„æ ¼å¼ä¸ä¸€è‡´

### æŠ€æœ¯ç»†èŠ‚
- å‰ç«¯ API é…ç½®ï¼š`/admin/users`
- Worker è·¯ç”±é…ç½®ï¼š`/api/admin/users`
- API è¿”å›æ ¼å¼ï¼š`{ users: [...] }`
- å‰ç«¯æœŸæœ›æ ¼å¼ï¼š`[...]` (ç›´æ¥æ•°ç»„)

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### 1. ä¿®æ­£ API é…ç½® (`src/lib/api-config.ts`)
- **é—®é¢˜**ï¼šAPI ç«¯ç‚¹è·¯å¾„ç¼ºå°‘ `/api` å‰ç¼€
- **è§£å†³**ï¼šä¸ºæ‰€æœ‰ç®¡ç†ç›¸å…³çš„ API ç«¯ç‚¹æ·»åŠ  `/api` å‰ç¼€

```typescript
// ä¿®æ”¹å‰
LIST: `${API_BASE_URL}/admin/users`,

// ä¿®æ”¹å
LIST: `${API_BASE_URL}/api/admin/users`,
```

### 2. ä¿®æ­£æ•°æ®æ ¼å¼å¤„ç† (`src/app/admin/page.tsx`)
- **é—®é¢˜**ï¼šAPI è¿”å› `{ users: [...] }` ä½†å‰ç«¯æœŸæœ›ç›´æ¥æ•°ç»„
- **è§£å†³**ï¼šæ­£ç¡®æå– `users` æ•°ç»„

```typescript
// ä¿®æ”¹å‰
const data = await apiRequestWithError(API_ENDPOINTS.USERS.LIST);
setUsers(data);

// ä¿®æ”¹å
const data = await apiRequestWithError(API_ENDPOINTS.USERS.LIST);
setUsers(data.users || data);
```

## âœ… éªŒè¯ç»“æœ

### API æµ‹è¯•
```bash
# æµ‹è¯•ç”¨æˆ·åˆ—è¡¨ API
curl -s https://udb.luocompany.net/api/admin/users

# è¿”å›ç»“æœ
{
  "users": [
    {
      "id": "cmd9wa3b100002m1jfs5knol8",
      "username": "luojun",
      "email": "b@b.net",
      "status": true,
      "isAdmin": true,
      // ... æ›´å¤šç”¨æˆ·æ•°æ®
    }
  ]
}
```

### å‰ç«¯éªŒè¯
- âœ… ç®¡ç†åå°é¡µé¢æ­£å¸¸åŠ è½½
- âœ… ç”¨æˆ·åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- âœ… æƒé™æ£€æŸ¥æ­£å¸¸å·¥ä½œ
- âœ… é”™è¯¯å¤„ç†æ­£ç¡®

## ğŸ“‹ ä¿®å¤çš„ API ç«¯ç‚¹

### ç”¨æˆ·ç®¡ç† API
- `GET /api/admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `GET /api/admin/users/{id}` - è·å–å•ä¸ªç”¨æˆ·
- `PUT /api/admin/users/{id}` - æ›´æ–°ç”¨æˆ·
- `PUT /api/admin/users/{id}/permissions` - æ›´æ–°ç”¨æˆ·æƒé™
- `POST /api/admin/users/{id}/permissions/batch` - æ‰¹é‡æ›´æ–°æƒé™

### è®¤è¯ API
- `POST /api/auth/d1-users` - ç”¨æˆ·è®¤è¯
- `GET /users/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

## ğŸ‰ æœ€ç»ˆæ•ˆæœ

ç°åœ¨ç®¡ç†åå°é¡µé¢èƒ½å¤Ÿï¼š

1. **æ­£ç¡®åŠ è½½ç”¨æˆ·åˆ—è¡¨**
2. **æ˜¾ç¤ºç”¨æˆ·è¯¦ç»†ä¿¡æ¯**
3. **æ”¯æŒç”¨æˆ·ç®¡ç†æ“ä½œ**
4. **æ­£ç¡®å¤„ç†æƒé™éªŒè¯**
5. **æä¾›å®Œæ•´çš„é”™è¯¯å¤„ç†**

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### API è·¯å¾„è§„èŒƒ
- **è®¤è¯ç›¸å…³**ï¼š`/auth/*`, `/users/me`
- **ç®¡ç†ç›¸å…³**ï¼š`/api/admin/*`
- **å…¶ä»–åŠŸèƒ½**ï¼š`/generate`, `/tools/*`

### æ•°æ®æ ¼å¼è§„èŒƒ
- **åˆ—è¡¨ API**ï¼šè¿”å› `{ items: [...] }` æ ¼å¼
- **å•ä¸ªé¡¹ç›®**ï¼šè¿”å›ç›´æ¥å¯¹è±¡
- **é”™è¯¯å“åº”**ï¼šè¿”å› `{ error: "é”™è¯¯ä¿¡æ¯" }`

### é”™è¯¯å¤„ç†
- **ç½‘ç»œé”™è¯¯**ï¼šæ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
- **æƒé™é”™è¯¯**ï¼šé‡å®šå‘åˆ°ä»ªè¡¨æ¿
- **æ•°æ®é”™è¯¯**ï¼šæ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

1. **ç»Ÿä¸€ API å“åº”æ ¼å¼**ï¼šæ‰€æœ‰ API ä½¿ç”¨ä¸€è‡´çš„å“åº”æ ¼å¼
2. **æ·»åŠ  API æ–‡æ¡£**ï¼šä¸ºæ‰€æœ‰ API ç«¯ç‚¹æä¾›æ–‡æ¡£
3. **å®ç°çœŸå®è®¤è¯**ï¼šæ›¿æ¢æ¨¡æ‹Ÿç”¨æˆ·ä¸ºçœŸå®ç”¨æˆ·è®¤è¯
4. **æ·»åŠ  API ç‰ˆæœ¬æ§åˆ¶**ï¼šä¸º API æ·»åŠ ç‰ˆæœ¬å·
5. **ä¼˜åŒ–é”™è¯¯å¤„ç†**ï¼šæä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ 